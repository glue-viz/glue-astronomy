[tox]
envlist = py{310,311,312,313}-{test,docs,codestyle}{,visual}-{dev}
requires = pip >= 18.0
           setuptools >= 30.3.0

[testenv]
setenv =
    dev: PIP_EXTRA_INDEX_URL = https://pypi.anaconda.org/astropy/simple https://pypi.anaconda.org/liberfa/simple https://pypi.anaconda.org/scientific-python-nightly-wheels/simple
    visual: MPLFLAGS = -m "mpl_image_compare" --mpl --mpl-generate-summary=html --mpl-results-path={toxinidir}/results --mpl-hash-library={toxinidir}/glue_astronomy/tests/visual/{envname}.json --mpl-baseline-path=https://raw.githubusercontent.com/glue-viz/glue-astronomy-visual-tests/main/images/{envname}/
passenv =
    HOME
changedir =
    docs: docs
deps =
    dev: numpy>=0.0.dev0
    dev: scipy>=0.0.dev0
    dev: astropy>=0.0.dev0
    dev: git+https://github.com/astropy/regions.git
    dev: git+https://github.com/astropy/specutils.git
    dev: git+https://github.com/astropy/specreduce.git
    dev: git+https://github.com/astropy/reproject.git
    dev: git+https://github.com/glue-viz/glue.git
    dev: git+https://github.com/glue-viz/glue-qt.git
    dev: git+https://github.com/radio-astro-tools/spectral-cube.git
    dev: git+https://github.com/radio-astro-tools/radio-beam.git
extras =
    test: test
    test: hips
    docs: docs
    visual: visualtest
commands =
    pip freeze
    test: pytest glue_astronomy --cov glue_astronomy {env:MPLFLAGS} {posargs}
    docs: sphinx-build -W -b html -d _build/doctrees   . _build/html

[testenv:codestyle]
skip_install = true
description = Run all style and file checks with pre-commit
deps =
    pre-commit
commands =
    pre-commit install-hooks
    pre-commit run --color always --all-files --show-diff-on-failure
